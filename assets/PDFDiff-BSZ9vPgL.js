import{d as Z}from"./index-_Ysoi3hW.js";import{l as L}from"./textLayer-BW6GH3Iy.js";import{_ as j}from"./plugin-vueexport-helper-DlAUqK2U.js";import{a as T,r as U,c as V,b as t,w as o,g as A,h as P,d as m,o as _,e as c,u as v,t as B,f as M,E as R}from"./index-CSOg7YfN.js";const O={class:"pdf-diff"},ee={key:0},ae={key:0},te={key:0},le=["innerHTML"],oe=["innerHTML"],ne={__name:"PDFDiff",setup(se){const w=T(),z=T();let x=null,h=null;const k=T(1),d=U({pageNumber:1,pageSize:0,checkStartPage:1,checkEndPage:1,pdfData:null,pdfText:"",diffHtml:""}),r=U({pageNumber:1,pageSize:0,checkStartPage:1,checkEndPage:1,pdfData:null,pdfText:"",diffHtml:""});let b=T(!1);const X=a=>{N(a,d)},I=a=>{N(a,r)},N=(a,e)=>{let l=new FileReader;l.readAsArrayBuffer(a.raw),l.onload=()=>{e.pdfData=l.result,e.pageNumber=1,e.pageSize=0,e.checkStartPage=1,e.checkEndPage=1}},$=a=>{D(w,a)},q=a=>{D(z,a)},D=(a,e)=>{var l,n;(l=a.value)==null||l.clearFiles(),(n=a.value)==null||n.handleStart(e[0])},G=()=>{g(x,d)},J=()=>{g(h,r)},K=()=>{d.pageNumber=k.value,r.pageNumber=k.value,g(x,d),g(h,r)},Q=a=>{x=a,g(x,d)},W=a=>{h=a,g(h,r)},g=(a,e)=>{e.pageSize==0&&(e.pageSize=a.numPages),a.getPage(e.pageNumber).then(l=>{l.getTextContent().then(n=>{e.pdfText=E(n)}).then(n=>{C(d.pdfText,r.pdfText)})}).catch(l=>{R.error(l.message)})},E=a=>{let e=0;for(let n=0;n<a.items.length;n++){let s=a.items[n],i=s.transform[4]+s.width;i>e&&(e=i)}let l="";for(let n=0;n<a.items.length;n++){let s=a.items[n];if(l=l+s.str,n<a.items.length-1){let i=a.items[n+1],p=s.transform[4]+s.width;s.transform[5]-i.transform[5]>s.height&&p<e-10&&(l=l+`
`)}}return l},C=(a,e)=>{let l=a.replaceAll(/(\.|!|\?)/g,`$1
`),n=e.replaceAll(/(\.|!|\?)/g,`$1
`);l=F(l),n=F(n);const s=Z(l,n);let i="",p="";s.forEach(f=>{f.added?p=S(p,f.value,"#97f295"):f.removed?i=S(i,f.value,"#ffb6ba"):(i=S(i,f.value,"#fff"),p=S(p,f.value,"#fff"))}),i=i.replaceAll(`
`,"<br/>"),p=p.replaceAll(`
`,"<br/>"),d.diffHtml=i,r.diffHtml=p},Y=()=>{b.value=!0;let a=H(x,d.checkStartPage,d.checkEndPage),e=H(h,r.checkStartPage,r.checkEndPage);Promise.all([a,e]).then(l=>{let n=l[0].join(`
`),s=l[1].join(`
`);C(n,s)}).finally(()=>{b.value=!1})},H=(a,e,l)=>{let n=[];for(let s=e;s<=l;s++)n.push(new Promise((i,p)=>{a.getPage(s).then(f=>{f.getTextContent().then(y=>{let u=E(y);i(u)})}).catch(f=>{R.error(f.message)})}));return Promise.all(n)},S=(a,e,l)=>(a=a+'<span style="white-space: pre-wrap; border-radius: .2em; background-color: '+l+'">'+e+"</span>",a),F=a=>{let e="";for(let l=0;l<a.length;l++)switch(a[l]){case".":e+="。";break;case",":e+="，";break;case";":e+="；";break;case":":e+="：";break;case"!":e+="！";break;case"?":e+="？";break;default:e+=a[l]}return e};return(a,e)=>{const l=m("el-button"),n=m("el-upload"),s=m("el-col"),i=m("el-row"),p=m("el-text"),f=m("el-input-number"),y=m("el-scrollbar");return _(),V("div",O,[t(i,{class:"pdf-upload"},{default:o(()=>[t(s,{span:12},{default:o(()=>[t(n,{ref_key:"pdfFile1",ref:w,"auto-upload":!1,limit:1,"on-change":X,"on-exceed":$},{default:o(()=>[t(l,{type:"primary"},{default:o(()=>[c("上传文件1")]),_:1})]),_:1},512)]),_:1}),t(s,{span:12},{default:o(()=>[t(n,{ref_key:"pdfFile2",ref:z,"auto-upload":!1,limit:1,"on-change":I,"on-exceed":q},{default:o(()=>[t(l,{type:"primary"},{default:o(()=>[c("上传文件2")]),_:1})]),_:1},512)]),_:1})]),_:1}),t(i,{class:"text-label"},{default:o(()=>[t(p,{tag:"b"},{default:o(()=>[c("PDF原文：")]),_:1})]),_:1}),t(i,{class:"diff-pdf"},{default:o(()=>[t(s,{span:12},{default:o(()=>[t(v(L),{"text-layer":"",source:d.pdfData,page:d.pageNumber,onLoaded:Q},null,8,["source","page"])]),_:1}),t(s,{span:12},{default:o(()=>[t(v(L),{"text-layer":"",source:r.pdfData,page:r.pageNumber,onLoaded:W},null,8,["source","page"])]),_:1})]),_:1}),d.pageSize||r.pageSize?(_(),A(i,{key:0,class:"diff-pdf-page"},{default:o(()=>[t(s,{span:7},{default:o(()=>[d.pageSize?(_(),V("div",ee,[t(p,{class:"mx-1"},{default:o(()=>[c("文件1 - 共"+B(d.pageSize)+"页 - 页码：",1)]),_:1}),t(f,{modelValue:d.pageNumber,"onUpdate:modelValue":e[0]||(e[0]=u=>d.pageNumber=u),min:1,max:d.pageSize,precision:0,onChange:G,style:{width:"130px"}},null,8,["modelValue","max"])])):P("",!0)]),_:1}),t(s,{span:10},{default:o(()=>[d.pageSize&&r.pageSize?(_(),V("div",ae,[t(p,{class:"mx-1"},{default:o(()=>[c("文件1和2 - 页码：")]),_:1}),t(f,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=u=>k.value=u),min:1,precision:0,onChange:K,style:{width:"130px"}},null,8,["modelValue"])])):P("",!0)]),_:1}),t(s,{span:7},{default:o(()=>[r.pageSize?(_(),V("div",te,[t(p,{class:"mx-1"},{default:o(()=>[c("文件2 - 共"+B(r.pageSize)+"页 - 页码：",1)]),_:1}),t(f,{modelValue:r.pageNumber,"onUpdate:modelValue":e[2]||(e[2]=u=>r.pageNumber=u),min:1,max:r.pageSize,precision:0,onChange:J,style:{width:"130px"}},null,8,["modelValue","max"])])):P("",!0)]),_:1})]),_:1})):P("",!0),d.pageSize&&r.pageSize?(_(),A(i,{key:1,class:"diff-pdf-page"},{default:o(()=>[t(s,null,{default:o(()=>[t(p,{class:"mx-1"},{default:o(()=>[c("文件1页码：")]),_:1}),t(f,{modelValue:d.checkStartPage,"onUpdate:modelValue":e[3]||(e[3]=u=>d.checkStartPage=u),min:1,max:d.pageSize,precision:0,controls:!1,style:{width:"75px"}},null,8,["modelValue","max"]),c(" ~ "),t(f,{modelValue:d.checkEndPage,"onUpdate:modelValue":e[4]||(e[4]=u=>d.checkEndPage=u),min:1,max:d.pageSize,precision:0,controls:!1,style:{width:"75px"}},null,8,["modelValue","max"]),t(p,{class:"mx-1",style:{"margin-left":"50px"}},{default:o(()=>[c("文件2页码：")]),_:1}),t(f,{modelValue:r.checkStartPage,"onUpdate:modelValue":e[5]||(e[5]=u=>r.checkStartPage=u),min:1,max:r.pageSize,precision:0,controls:!1,style:{width:"75px"}},null,8,["modelValue","max"]),c(" ~ "),t(f,{modelValue:r.checkEndPage,"onUpdate:modelValue":e[6]||(e[6]=u=>r.checkEndPage=u),min:1,max:r.pageSize,precision:0,controls:!1,style:{width:"75px"}},null,8,["modelValue","max"]),t(l,{type:"primary",loading:v(b),disabled:v(b),onClick:Y,style:{width:"100px","margin-left":"50px"}},{default:o(()=>[c("章节比对")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})):P("",!0),t(i,{class:"text-label"},{default:o(()=>[t(p,{tag:"b"},{default:o(()=>[c("比对结果：")]),_:1})]),_:1}),t(i,{class:"diff-result"},{default:o(()=>[t(s,{span:12},{default:o(()=>[t(y,{"max-height":"600px"},{default:o(()=>[M("div",{innerHTML:d.diffHtml},null,8,le)]),_:1})]),_:1}),t(s,{span:12},{default:o(()=>[t(y,{"max-height":"600px"},{default:o(()=>[M("div",{innerHTML:r.diffHtml},null,8,oe)]),_:1})]),_:1})]),_:1})])}}},fe=j(ne,[["__scopeId","data-v-45447ea0"]]);export{fe as default};
